<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - CondoTrack Pro | Teste Gratis por 15 Dias</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24'%3E%3Crect width='24' height='24' rx='6' fill='%2310b981'/%3E%3Cpath d='M7 12a5 5 0 0 1 5-5h5' stroke='white' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E">
    <!-- Tailwind CSS via CDN (apenas para desenvolvimento - remover em produção) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .neon-shadow-green {
            box-shadow: 0 0 10px rgba(50, 255, 100, 0.6), 0 0 20px rgba(50, 255, 100, 0.4);
        }
        .neon-shadow-cyan {
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.6), 0 0 20px rgba(0, 191, 255, 0.4);
        }
        .bg-gradient-dark {
            background: linear-gradient(145deg, #1f2937 0%, #111827 60%, #000000 100%);
        }
        .form-input {
            transition: all 0.2s ease;
        }
        .form-input:focus {
            transform: translateY(-1px);
        }
        .form-input.error {
            border-color: #ef4444 !important;
            animation: shake 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .section-divider {
            position: relative;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .section-divider::before,
        .section-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, #374151, transparent);
        }
        .field-hint {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        .field-error {
            font-size: 0.75rem;
            color: #ef4444;
            margin-top: 0.25rem;
            display: none;
        }
        .field-error.show {
            display: block;
        }
    </style>
</head>
<body class="bg-gradient-dark min-h-screen text-gray-100 antialiased">

    <!-- Header -->
    <header class="bg-gray-800/80 backdrop-blur-sm p-4 border-b border-gray-700 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="/" class="text-2xl font-extrabold text-white tracking-wider hover:opacity-80 transition-opacity">
                <span class="text-cyan-400">Condo</span>Track Pro
            </a>
            <nav class="flex items-center gap-4">
                <span class="text-gray-400 text-sm hidden sm:inline">Ja tem conta?</span>
                <a href="/app.html" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-full text-sm font-bold transition-all">
                    Fazer Login
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="py-12 px-4">
        <div class="max-w-6xl mx-auto">
            <div class="grid lg:grid-cols-5 gap-12 items-start">

                <!-- Left Side - Benefits (2 colunas) -->
                <div class="hidden lg:block lg:col-span-2">
                    <div class="sticky top-24">
                        <span class="text-sm font-bold text-green-400 uppercase tracking-widest bg-green-500/10 px-3 py-1 rounded-full inline-block mb-4">
                            TESTE GRATIS POR 15 DIAS
                        </span>
                        <h1 class="text-4xl font-extrabold text-white mb-4 leading-tight">
                            Comece Agora e Transforme a Gestao do seu Condominio
                        </h1>
                        <p class="text-gray-400 text-lg mb-8">
                            Configure em menos de 5 minutos. Sem cartao de credito. Cancele quando quiser.
                        </p>

                        <ul class="space-y-4 mb-8">
                            <li class="flex items-start gap-3">
                                <div class="bg-green-500/20 p-2 rounded-lg flex-shrink-0">
                                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-white">Registro de Encomendas</h3>
                                    <p class="text-gray-400 text-sm">Controle total de todas as entregas do condominio</p>
                                </div>
                            </li>
                            <li class="flex items-start gap-3">
                                <div class="bg-green-500/20 p-2 rounded-lg flex-shrink-0">
                                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-white">Notificacao por WhatsApp</h3>
                                    <p class="text-gray-400 text-sm">Avise moradores automaticamente sobre encomendas</p>
                                </div>
                            </li>
                            <li class="flex items-start gap-3">
                                <div class="bg-green-500/20 p-2 rounded-lg flex-shrink-0">
                                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-white">Relatorios e Auditoria</h3>
                                    <p class="text-gray-400 text-sm">Historico completo com exportacao em PDF</p>
                                </div>
                            </li>
                            <li class="flex items-start gap-3">
                                <div class="bg-green-500/20 p-2 rounded-lg flex-shrink-0">
                                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-white">Multiplos Porteiros</h3>
                                    <p class="text-gray-400 text-sm">Cada porteiro com seu proprio login</p>
                                </div>
                            </li>
                        </ul>

                        <!-- Plan Badge -->
                        <div id="planBadge" class="bg-gray-800/60 border border-gray-700 rounded-xl p-4">
                            <p class="text-sm text-gray-400 mb-1">Plano selecionado:</p>
                            <p class="text-xl font-bold text-white" id="selectedPlanName">BASICO</p>
                            <p class="text-green-400 text-sm">15 dias gratis, depois <span id="selectedPlanPrice">R$ 99/mes</span></p>
                        </div>

                        <!-- Trust Badges -->
                        <div class="mt-6 flex items-center gap-4 text-gray-500 text-xs">
                            <div class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                <span>Dados seguros</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                                <span>LGPD Compliant</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Form (3 colunas) -->
                <div class="w-full lg:col-span-3">
                    <div class="bg-gray-800/60 border border-gray-700 rounded-2xl p-6 sm:p-8 shadow-2xl">
                        <div class="text-center mb-6 lg:hidden">
                            <span class="text-sm font-bold text-green-400 uppercase tracking-widest bg-green-500/10 px-3 py-1 rounded-full inline-block mb-3">
                                TESTE GRATIS POR 15 DIAS
                            </span>
                            <h1 class="text-2xl font-extrabold text-white">Crie sua Conta</h1>
                        </div>

                        <h2 class="text-xl font-bold text-white mb-6 hidden lg:block">Crie sua Conta</h2>


                        <!-- Registration Form -->
                        <form id="registerForm" class="space-y-6">

                            <!-- ================================================================ -->
                            <!-- SECAO 1: DADOS DO CONDOMINIO (PESSOA JURIDICA) -->
                            <!-- ================================================================ -->
                            <div class="space-y-4">
                                <div class="section-divider">
                                    <h3 class="text-sm font-semibold text-cyan-400 uppercase tracking-wider flex items-center gap-2 whitespace-nowrap">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                                        Dados do Condominio (PJ)
                                    </h3>
                                </div>

                                <!-- Nome do Condominio -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="condoName">
                                        Nome do Condominio / Empresa *
                                    </label>
                                    <input
                                        type="text"
                                        id="condoName"
                                        name="condoName"
                                        required
                                        placeholder="Ex: Residencial Solar das Flores"
                                        class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                    >
                                    <p class="field-error" id="condoNameError">Informe o nome do condominio</p>
                                </div>

                                <!-- CPF ou CNPJ -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="condoDocument">
                                        CPF ou CNPJ *
                                    </label>
                                    <input
                                        type="text"
                                        id="condoDocument"
                                        name="condoDocument"
                                        required
                                        maxlength="18"
                                        placeholder="000.000.000-00 ou 00.000.000/0000-00"
                                        class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                    >
                                    <p class="field-hint">Necessario para emissao de nota fiscal</p>
                                    <p class="field-error" id="condoDocumentError">Informe um CPF ou CNPJ valido</p>
                                </div>

                                <!-- Endereco Completo -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- CEP -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2" for="condoCep">
                                            CEP *
                                        </label>
                                        <input
                                            type="text"
                                            id="condoCep"
                                            name="condoCep"
                                            required
                                            maxlength="9"
                                            placeholder="00000-000"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                        >
                                        <p class="field-error" id="condoCepError">Informe um CEP valido</p>
                                    </div>

                                    <!-- Numero -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2" for="condoNumber">
                                            Numero *
                                        </label>
                                        <input
                                            type="text"
                                            id="condoNumber"
                                            name="condoNumber"
                                            required
                                            placeholder="123"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                        >
                                        <p class="field-error" id="condoNumberError">Informe o numero</p>
                                    </div>
                                </div>

                                <!-- Rua -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="condoStreet">
                                        Rua / Logradouro *
                                    </label>
                                    <input
                                        type="text"
                                        id="condoStreet"
                                        name="condoStreet"
                                        required
                                        placeholder="Ex: Rua das Palmeiras"
                                        class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                    >
                                    <p class="field-error" id="condoStreetError">Informe a rua</p>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- Bairro -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2" for="condoNeighborhood">
                                            Bairro *
                                        </label>
                                        <input
                                            type="text"
                                            id="condoNeighborhood"
                                            name="condoNeighborhood"
                                            required
                                            placeholder="Ex: Centro"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                        >
                                        <p class="field-error" id="condoNeighborhoodError">Informe o bairro</p>
                                    </div>

                                    <!-- Complemento -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2" for="condoComplement">
                                            Complemento
                                        </label>
                                        <input
                                            type="text"
                                            id="condoComplement"
                                            name="condoComplement"
                                            placeholder="Bloco, Sala, etc (opcional)"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                        >
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <!-- Cidade -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2" for="condoCity">
                                            Cidade *
                                        </label>
                                        <input
                                            type="text"
                                            id="condoCity"
                                            name="condoCity"
                                            required
                                            placeholder="Ex: Sao Paulo"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                        >
                                        <p class="field-error" id="condoCityError">Informe a cidade</p>
                                    </div>

                                    <!-- Estado -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-300 mb-2" for="condoState">
                                            Estado *
                                        </label>
                                        <select
                                            id="condoState"
                                            name="condoState"
                                            required
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                        >
                                            <option value="">Selecione...</option>
                                            <option value="AC">Acre</option>
                                            <option value="AL">Alagoas</option>
                                            <option value="AP">Amapa</option>
                                            <option value="AM">Amazonas</option>
                                            <option value="BA">Bahia</option>
                                            <option value="CE">Ceara</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="ES">Espirito Santo</option>
                                            <option value="GO">Goias</option>
                                            <option value="MA">Maranhao</option>
                                            <option value="MT">Mato Grosso</option>
                                            <option value="MS">Mato Grosso do Sul</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PA">Para</option>
                                            <option value="PB">Paraiba</option>
                                            <option value="PR">Parana</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="PI">Piaui</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="RN">Rio Grande do Norte</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="RO">Rondonia</option>
                                            <option value="RR">Roraima</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="SP">Sao Paulo</option>
                                            <option value="SE">Sergipe</option>
                                            <option value="TO">Tocantins</option>
                                        </select>
                                        <p class="field-error" id="condoStateError">Selecione o estado</p>
                                    </div>
                                </div>
                            </div>

                            <!-- ================================================================ -->
                            <!-- SECAO 2: DADOS DO ADMINISTRADOR (SINDICO - PESSOA FISICA) -->
                            <!-- ================================================================ -->
                            <div class="space-y-4 pt-4">
                                <div class="section-divider">
                                    <h3 class="text-sm font-semibold text-cyan-400 uppercase tracking-wider flex items-center gap-2 whitespace-nowrap">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                        Dados do Administrador (Sindico)
                                    </h3>
                                </div>

                                <!-- Nome Completo -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="adminName">
                                        Nome Completo *
                                    </label>
                                    <input
                                        type="text"
                                        id="adminName"
                                        name="adminName"
                                        required
                                        placeholder="Ex: Joao da Silva Santos"
                                        class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                    >
                                    <p class="field-hint">Informe nome e sobrenome</p>
                                    <p class="field-error" id="adminNameError">Informe o nome completo (nome e sobrenome)</p>
                                </div>

                                <!-- E-mail -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="adminEmail">
                                        E-mail (sera seu login) *
                                    </label>
                                    <input
                                        type="email"
                                        id="adminEmail"
                                        name="adminEmail"
                                        required
                                        placeholder="Ex: joao@email.com"
                                        class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all"
                                    >
                                    <p class="field-error" id="adminEmailError">Informe um e-mail valido</p>
                                </div>

                                <!-- Senha -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="adminPassword">
                                        Senha *
                                    </label>
                                    <div class="relative">
                                        <input
                                            type="password"
                                            id="adminPassword"
                                            name="adminPassword"
                                            required
                                            minlength="6"
                                            placeholder="Minimo 6 caracteres"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all pr-12"
                                        >
                                        <button type="button" id="togglePassword" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors">
                                            <svg class="w-5 h-5" id="eyeIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                        </button>
                                    </div>
                                    <!-- Password Strength Indicator -->
                                    <div class="mt-2">
                                        <div class="flex gap-1">
                                            <div id="pwStr1" class="h-1 flex-1 rounded bg-gray-700"></div>
                                            <div id="pwStr2" class="h-1 flex-1 rounded bg-gray-700"></div>
                                            <div id="pwStr3" class="h-1 flex-1 rounded bg-gray-700"></div>
                                            <div id="pwStr4" class="h-1 flex-1 rounded bg-gray-700"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1" id="pwStrText">Forca da senha</p>
                                    </div>
                                    <p class="field-error" id="adminPasswordError">A senha deve ter pelo menos 6 caracteres</p>
                                </div>

                                <!-- Confirmar Senha -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2" for="adminPasswordConfirm">
                                        Confirmar Senha *
                                    </label>
                                    <div class="relative">
                                        <input
                                            type="password"
                                            id="adminPasswordConfirm"
                                            name="adminPasswordConfirm"
                                            required
                                            minlength="6"
                                            placeholder="Digite a senha novamente"
                                            class="form-input w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 outline-none transition-all pr-12"
                                        >
                                        <span id="passwordMatch" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                        </span>
                                        <span id="passwordNoMatch" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                                            <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                        </span>
                                    </div>
                                    <p class="field-error" id="adminPasswordConfirmError">As senhas nao conferem</p>
                                </div>
                            </div>

                            <!-- Hidden plan field -->
                            <input type="hidden" id="selectedPlan" name="selectedPlan" value="basic">

                            <!-- Error Message -->
                            <div id="errorMessage" class="hidden bg-red-500/20 border border-red-500/50 text-red-400 px-4 py-3 rounded-xl text-sm animate-fadeIn">
                            </div>

                            <!-- Terms -->
                            <div class="flex items-start gap-3 pt-2">
                                <input
                                    type="checkbox"
                                    id="acceptTerms"
                                    name="acceptTerms"
                                    required
                                    class="mt-1 w-5 h-5 bg-gray-900 border-gray-600 rounded text-cyan-500 focus:ring-cyan-500 cursor-pointer"
                                >
                                <label for="acceptTerms" class="text-sm text-gray-400 cursor-pointer">
                                    Li e concordo com os <a href="#" class="text-cyan-400 hover:underline">Termos de Servico</a> e <a href="#" class="text-cyan-400 hover:underline">Politica de Privacidade</a> *
                                </label>
                            </div>
                            <p class="field-error -mt-4" id="acceptTermsError">Voce deve aceitar os termos para continuar</p>

                            <!-- Submit Button -->
                            <button
                                type="submit"
                                id="submitBtn"
                                class="w-full bg-green-500 hover:bg-green-600 text-slate-900 px-6 py-4 rounded-xl text-lg font-bold neon-shadow-green transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2 mt-6"
                            >
                                <span id="submitText">Comecar Teste Gratis</span>
                                <div id="submitSpinner" class="spinner hidden"></div>
                            </button>

                            <p class="text-center text-gray-500 text-xs">
                                Ao criar sua conta, voce inicia um periodo de teste gratis de 15 dias.
                                Nenhum cartao de credito e necessario.
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ================================================================ -->
    <!-- MODAL DE SUCESSO -->
    <!-- ================================================================ -->
    <div id="successModal" class="fixed inset-0 z-50 hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>

        <!-- Modal Content -->
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl max-w-lg w-full p-8 animate-fadeIn">

                <!-- Success Icon -->
                <div class="text-center mb-6">
                    <div class="bg-green-500/20 p-4 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-extrabold text-white mb-2">Cadastro Concluido!</h2>
                    <p class="text-gray-400">Seu teste gratis de 15 dias foi ativado.</p>
                </div>

                <!-- Dados de Acesso -->
                <div class="bg-gray-900 rounded-xl p-5 mb-6 space-y-4">
                    <h3 class="text-sm font-bold text-cyan-400 uppercase tracking-wider mb-3">
                        Seus Dados de Acesso
                    </h3>

                    <!-- Condo ID -->
                    <div class="bg-gray-800 rounded-lg p-3">
                        <label class="block text-xs text-gray-500 uppercase tracking-wider mb-1">ID do Condominio</label>
                        <div class="flex items-center gap-2">
                            <code id="modalCondoId" class="flex-1 text-green-400 font-mono text-sm break-all select-all"></code>
                            <button onclick="copyToClipboard('modalCondoId')" class="text-gray-400 hover:text-white p-1 transition-colors" title="Copiar">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="bg-gray-800 rounded-lg p-3">
                        <label class="block text-xs text-gray-500 uppercase tracking-wider mb-1">E-mail (Login)</label>
                        <p id="modalAdminEmail" class="text-cyan-400 font-medium"></p>
                    </div>

                    <!-- Aviso -->
                    <div class="flex items-start gap-2 text-amber-400 text-xs mt-3">
                        <svg class="w-4 h-4 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <span>Guarde o ID do Condominio! Todos os usuarios precisarao dele para fazer login.</span>
                    </div>
                </div>

                <!-- Instrucoes -->
                <div class="bg-gray-900/50 rounded-xl p-4 mb-6">
                    <h4 class="text-white font-semibold mb-2">Proximo passo:</h4>
                    <ol class="text-gray-400 text-sm space-y-1">
                        <li>1. Clique no botao abaixo</li>
                        <li>2. Os campos de login serao pre-preenchidos</li>
                        <li>3. Digite sua senha e acesse o sistema</li>
                    </ol>
                </div>

                <!-- Botao de Login -->
                <button
                    id="btnGoToLogin"
                    onclick="goToLoginWithCredentials()"
                    class="w-full bg-green-500 hover:bg-green-600 text-slate-900 px-6 py-4 rounded-xl text-lg font-bold transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    Fazer Login Agora
                </button>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-6 text-gray-500 border-t border-gray-800 text-sm mt-12">
        <p>&copy; 2025 CondoTrack Pro. Todos os direitos reservados.</p>
        <p class="mt-2 text-gray-600">Desenvolvido por <a href="https://playcodeagency.xyz" target="_blank" class="text-cyan-500 hover:text-cyan-400 transition-colors">PlayCodeAgency</a></p>
    </footer>

    <script>
        // ================================================================
        // SUPABASE CLIENT - PRODUCAO
        // ================================================================
        const SUPABASE_URL = 'https://slsmtndfsydmaixsqkcj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNsc210bmRmc3lkbWFpeHNxa2NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1NTk4MjUsImV4cCI6MjA2NDEzNTgyNX0.rnfsRR45lIkcea6DcZpLGCKuN7GNdpdpFgRYytCPT0c';

        // Verifica se window.supabase existe antes de criar o cliente
        if (typeof window.supabase === 'undefined') {
            console.error('[Register] Supabase library não carregada! Verifique se o script foi incluído.');
        }
        
        // Usa nome único para evitar conflitos com extensões do navegador
        const supabaseClient = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        if (!supabaseClient) {
            console.error('[Register] Erro ao criar cliente Supabase!');
        }

        console.log('[Register] Supabase client inicializado:', SUPABASE_URL);

        // ================================================================
        // CONFIGURACAO DOS PLANOS
        // ================================================================
        const plans = {
            basic: { name: 'BASICO', price: 'R$ 99/mes', staffLimit: 2, unitLimit: 50 },
            professional: { name: 'PRO', price: 'R$ 199/mes', staffLimit: 5, unitLimit: 150 },
            premium: { name: 'PREMIUM', price: 'R$ 349/mes', staffLimit: 10, unitLimit: 9999 }
        };

        // Pega o plano da URL
        const urlParams = new URLSearchParams(window.location.search);
        const planParam = urlParams.get('plan') || 'basic';
        const selectedPlan = plans[planParam] || plans.basic;

        // Atualiza UI com o plano selecionado
        document.getElementById('selectedPlan').value = planParam;
        document.getElementById('selectedPlanName').textContent = selectedPlan.name;
        document.getElementById('selectedPlanPrice').textContent = selectedPlan.price;

        // ================================================================
        // MASCARAS DE INPUT
        // ================================================================

        // Mascara CPF/CNPJ
        function formatDocument(value) {
            const numbers = value.replace(/\D/g, '');
            if (numbers.length <= 11) {
                // CPF: 000.000.000-00
                return numbers
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                // CNPJ: 00.000.000/0000-00
                return numbers
                    .replace(/^(\d{2})(\d)/, '$1.$2')
                    .replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3')
                    .replace(/\.(\d{3})(\d)/, '.$1/$2')
                    .replace(/(\d{4})(\d)/, '$1-$2')
                    .substring(0, 18);
            }
        }

        // Mascara CEP
        function formatCep(value) {
            const numbers = value.replace(/\D/g, '');
            return numbers.replace(/(\d{5})(\d)/, '$1-$2').substring(0, 9);
        }

        // Aplica mascaras
        document.getElementById('condoDocument').addEventListener('input', function(e) {
            e.target.value = formatDocument(e.target.value);
        });

        document.getElementById('condoCep').addEventListener('input', function(e) {
            e.target.value = formatCep(e.target.value);
        });

        // ================================================================
        // BUSCA CNPJ (BrasilAPI) - Auto-preenche dados da empresa
        // ================================================================
        let cnpjSearchTimeout = null;
        const cnpjField = document.getElementById('condoDocument');

        // Indicador de loading no campo
        function setCnpjLoading(loading) {
            if (loading) {
                cnpjField.classList.add('opacity-70');
                cnpjField.style.backgroundImage = "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24'%3E%3Cpath fill='%2306b6d4' d='M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z' opacity='.3'/%3E%3Cpath fill='%2306b6d4' d='M20 12h2A10 10 0 0 0 12 2v2a8 8 0 0 1 8 8z'%3E%3CanimateTransform attributeName='transform' dur='1s' from='0 12 12' repeatCount='indefinite' to='360 12 12' type='rotate'/%3E%3C/path%3E%3C/svg%3E\")";
                cnpjField.style.backgroundRepeat = 'no-repeat';
                cnpjField.style.backgroundPosition = 'right 12px center';
                cnpjField.style.backgroundSize = '20px';
            } else {
                cnpjField.classList.remove('opacity-70');
                cnpjField.style.backgroundImage = '';
            }
        }

        // Busca dados do CNPJ na BrasilAPI
        async function fetchCNPJData(cnpj) {
            const numbers = cnpj.replace(/\D/g, '');

            // So busca se for CNPJ (14 digitos)
            if (numbers.length !== 14) return null;

            setCnpjLoading(true);

            try {
                const response = await fetch(`https://brasilapi.com.br/api/cnpj/v1/${numbers}`);

                if (!response.ok) {
                    console.log('[CNPJ] Empresa nao encontrada ou API indisponivel');
                    return null;
                }

                const data = await response.json();
                console.log('[CNPJ] Dados recebidos:', data);
                return data;

            } catch (error) {
                console.log('[CNPJ] Erro na busca:', error);
                return null;
            } finally {
                setCnpjLoading(false);
            }
        }

        // Preenche os campos com dados do CNPJ
        function fillFromCNPJ(data) {
            if (!data) return;

            // Nome da empresa (razao social ou nome fantasia)
            const condoNameField = document.getElementById('condoName');
            if (!condoNameField.value && (data.razao_social || data.nome_fantasia)) {
                condoNameField.value = data.nome_fantasia || data.razao_social;
                condoNameField.classList.add('animate-fadeIn');
                setTimeout(() => condoNameField.classList.remove('animate-fadeIn'), 300);
            }

            // Endereco
            if (data.cep) {
                const cepField = document.getElementById('condoCep');
                cepField.value = formatCep(data.cep);
            }

            if (data.logradouro) {
                document.getElementById('condoStreet').value = data.descricao_tipo_de_logradouro
                    ? `${data.descricao_tipo_de_logradouro} ${data.logradouro}`
                    : data.logradouro;
            }

            if (data.numero) {
                document.getElementById('condoNumber').value = data.numero;
            }

            if (data.complemento) {
                document.getElementById('condoComplement').value = data.complemento;
            }

            if (data.bairro) {
                document.getElementById('condoNeighborhood').value = data.bairro;
            }

            if (data.municipio) {
                document.getElementById('condoCity').value = data.municipio;
            }

            if (data.uf) {
                document.getElementById('condoState').value = data.uf;
            }

            // Feedback visual de sucesso
            showCnpjSuccess();
        }

        // Mostra feedback de sucesso
        function showCnpjSuccess() {
            const hint = document.querySelector('#condoDocument + .field-hint');
            if (hint) {
                const originalText = hint.textContent;
                hint.textContent = '✓ Dados da empresa preenchidos automaticamente!';
                hint.classList.remove('text-gray-500');
                hint.classList.add('text-green-400');

                setTimeout(() => {
                    hint.textContent = originalText;
                    hint.classList.remove('text-green-400');
                    hint.classList.add('text-gray-500');
                }, 3000);
            }
        }

        // Listener para busca automatica ao sair do campo ou apos digitar
        cnpjField.addEventListener('blur', async function(e) {
            const value = e.target.value.replace(/\D/g, '');

            // So busca se for CNPJ valido (14 digitos)
            if (value.length === 14 && validateCNPJ(value)) {
                const data = await fetchCNPJData(value);
                if (data) {
                    fillFromCNPJ(data);
                }
            }
        });

        // ================================================================
        // BUSCA CEP (ViaCEP)
        // ================================================================
        document.getElementById('condoCep').addEventListener('blur', async function(e) {
            const cep = e.target.value.replace(/\D/g, '');
            if (cep.length === 8) {
                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();
                    if (!data.erro) {
                        document.getElementById('condoStreet').value = data.logradouro || '';
                        document.getElementById('condoNeighborhood').value = data.bairro || '';
                        document.getElementById('condoCity').value = data.localidade || '';
                        document.getElementById('condoState').value = data.uf || '';
                        // Foca no campo numero apos preencher
                        document.getElementById('condoNumber').focus();
                    }
                } catch (error) {
                    console.log('Erro ao buscar CEP:', error);
                }
            }
        });

        // ================================================================
        // VALIDACAO DE SENHA
        // ================================================================

        // Toggle mostrar/ocultar senha
        document.getElementById('togglePassword').addEventListener('click', function() {
            const pwField = document.getElementById('adminPassword');
            const eyeIcon = document.getElementById('eyeIcon');
            if (pwField.type === 'password') {
                pwField.type = 'text';
                eyeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>';
            } else {
                pwField.type = 'password';
                eyeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>';
            }
        });

        // Indicador de forca da senha
        document.getElementById('adminPassword').addEventListener('input', function(e) {
            const password = e.target.value;
            let strength = 0;

            if (password.length >= 6) strength++;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password) && /[a-z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            const colors = ['bg-gray-700', 'bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500'];
            const texts = ['Forca da senha', 'Muito fraca', 'Fraca', 'Media', 'Forte'];

            for (let i = 1; i <= 4; i++) {
                const el = document.getElementById(`pwStr${i}`);
                el.className = `h-1 flex-1 rounded ${i <= strength ? colors[strength] : 'bg-gray-700'}`;
            }
            document.getElementById('pwStrText').textContent = texts[strength] || texts[0];
            document.getElementById('pwStrText').className = `text-xs mt-1 ${strength >= 3 ? 'text-green-400' : strength >= 2 ? 'text-yellow-400' : 'text-gray-500'}`;
        });

        // Verifica se senhas conferem
        document.getElementById('adminPasswordConfirm').addEventListener('input', function(e) {
            const password = document.getElementById('adminPassword').value;
            const confirm = e.target.value;
            const matchIcon = document.getElementById('passwordMatch');
            const noMatchIcon = document.getElementById('passwordNoMatch');

            if (confirm.length === 0) {
                matchIcon.classList.add('hidden');
                noMatchIcon.classList.add('hidden');
            } else if (password === confirm) {
                matchIcon.classList.remove('hidden');
                noMatchIcon.classList.add('hidden');
            } else {
                matchIcon.classList.add('hidden');
                noMatchIcon.classList.remove('hidden');
            }
        });

        // ================================================================
        // FUNCOES DE UI
        // ================================================================

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            errorEl.classList.add('animate-shake');
            setTimeout(() => errorEl.classList.remove('animate-shake'), 300);
            // Scroll to error
            errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function hideError() {
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function showFieldError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorEl = document.getElementById(`${fieldId}Error`);
            if (field) field.classList.add('error');
            if (errorEl) errorEl.classList.add('show');
        }

        function hideFieldError(fieldId) {
            const field = document.getElementById(fieldId);
            const errorEl = document.getElementById(`${fieldId}Error`);
            if (field) field.classList.remove('error');
            if (errorEl) errorEl.classList.remove('show');
        }

        function clearAllFieldErrors() {
            document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
            document.querySelectorAll('.field-error').forEach(el => el.classList.remove('show'));
        }

        function setLoading(loading) {
            const btn = document.getElementById('submitBtn');
            const text = document.getElementById('submitText');
            const spinner = document.getElementById('submitSpinner');

            if (loading) {
                btn.disabled = true;
                btn.classList.add('opacity-70', 'cursor-not-allowed');
                text.textContent = 'Criando sua conta...';
                spinner.classList.remove('hidden');
            } else {
                btn.disabled = false;
                btn.classList.remove('opacity-70', 'cursor-not-allowed');
                text.textContent = 'Comecar Teste Gratis';
                spinner.classList.add('hidden');
            }
        }

        // ================================================================
        // VALIDACOES
        // ================================================================

        function validateCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;

            let sum = 0;
            for (let i = 0; i < 9; i++) sum += parseInt(cpf[i]) * (10 - i);
            let rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            if (rest !== parseInt(cpf[9])) return false;

            sum = 0;
            for (let i = 0; i < 10; i++) sum += parseInt(cpf[i]) * (11 - i);
            rest = (sum * 10) % 11;
            if (rest === 10 || rest === 11) rest = 0;
            return rest === parseInt(cpf[10]);
        }

        function validateCNPJ(cnpj) {
            cnpj = cnpj.replace(/\D/g, '');
            if (cnpj.length !== 14 || /^(\d)\1+$/.test(cnpj)) return false;

            let size = cnpj.length - 2;
            let numbers = cnpj.substring(0, size);
            let digits = cnpj.substring(size);
            let sum = 0;
            let pos = size - 7;

            for (let i = size; i >= 1; i--) {
                sum += numbers.charAt(size - i) * pos--;
                if (pos < 2) pos = 9;
            }
            let result = sum % 11 < 2 ? 0 : 11 - sum % 11;
            if (result !== parseInt(digits.charAt(0))) return false;

            size++;
            numbers = cnpj.substring(0, size);
            sum = 0;
            pos = size - 7;

            for (let i = size; i >= 1; i--) {
                sum += numbers.charAt(size - i) * pos--;
                if (pos < 2) pos = 9;
            }
            result = sum % 11 < 2 ? 0 : 11 - sum % 11;
            return result === parseInt(digits.charAt(1));
        }

        function validateDocument(doc) {
            const numbers = doc.replace(/\D/g, '');
            if (numbers.length === 11) return validateCPF(numbers);
            if (numbers.length === 14) return validateCNPJ(numbers);
            return false;
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function validateFullName(name) {
            const parts = name.trim().split(/\s+/);
            return parts.length >= 2 && parts.every(p => p.length >= 2);
        }

        // ================================================================
        // FUNCAO GERADORA DE UUID (formato padrao)
        // ================================================================
        function generateUUID() {
            // Gera UUID v4 compativel
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // ================================================================
        // FUNCAO PRINCIPAL DE REGISTRO (VIA EDGE FUNCTION)
        // ================================================================
        async function handleRegistration(formData) {
            const EDGE_FUNCTION_URL = `${SUPABASE_URL}/functions/v1/register-condo`;
            
            console.log('[REGISTRO] Chamando Edge Function de registro:', EDGE_FUNCTION_URL);

            // Chama a Edge Function para criar o condomínio e admin
            const response = await fetch(EDGE_FUNCTION_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                },
                body: JSON.stringify({
                    condoName: formData.condoName,
                    condoDocument: formData.condoDocument,
                    condoCep: formData.condoCep,
                    condoStreet: formData.condoStreet,
                    condoNumber: formData.condoNumber,
                    condoComplement: formData.condoComplement,
                    condoNeighborhood: formData.condoNeighborhood,
                    condoCity: formData.condoCity,
                    condoState: formData.condoState,
                    adminName: formData.adminName,
                    adminEmail: formData.adminEmail,
                    adminPassword: formData.adminPassword,
                    planType: formData.planType || 'basic'
                })
            });

            const data = await response.json();

            if (!response.ok) {
                console.error('[REGISTRO] Erro na Edge Function:', data);
                throw new Error(data.error || 'Erro ao criar conta. Tente novamente.');
            }

            if (!data.success) {
                console.error('[REGISTRO] Registro falhou:', data);
                throw new Error(data.error || 'Erro ao criar conta.');
            }

            console.log('[REGISTRO] Cadastro concluído com sucesso:', data);

            // Retorna os dados de sucesso
            return {
                condoId: data.condoId,
                username: data.username,
                trialEndDate: data.trialEndDate,
                condoName: data.condoName
            };
        }

        // ================================================================
        // HANDLER DO FORMULARIO
        // ================================================================
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideError();
            clearAllFieldErrors();

            // Coleta dados do formulario
            const formData = {
                // Dados do Condominio (PJ)
                condoName: document.getElementById('condoName').value.trim(),
                condoDocument: document.getElementById('condoDocument').value.trim(),
                condoCep: document.getElementById('condoCep').value.trim(),
                condoStreet: document.getElementById('condoStreet').value.trim(),
                condoNumber: document.getElementById('condoNumber').value.trim(),
                condoComplement: document.getElementById('condoComplement').value.trim(),
                condoNeighborhood: document.getElementById('condoNeighborhood').value.trim(),
                condoCity: document.getElementById('condoCity').value.trim(),
                condoState: document.getElementById('condoState').value,
                // Dados do Administrador (PF)
                adminName: document.getElementById('adminName').value.trim(),
                adminEmail: document.getElementById('adminEmail').value.trim().toLowerCase(),
                adminPassword: document.getElementById('adminPassword').value,
                adminPasswordConfirm: document.getElementById('adminPasswordConfirm').value,
                // Plano
                planType: document.getElementById('selectedPlan').value,
                // Termos
                acceptTerms: document.getElementById('acceptTerms').checked
            };

            // ================================================================
            // VALIDACOES
            // ================================================================
            let hasError = false;
            let firstErrorField = null;

            // Validacao: Nome do Condominio
            if (!formData.condoName) {
                showFieldError('condoName');
                hasError = true;
                firstErrorField = firstErrorField || 'condoName';
            }

            // Validacao: CPF/CNPJ
            if (!formData.condoDocument || !validateDocument(formData.condoDocument)) {
                showFieldError('condoDocument');
                hasError = true;
                firstErrorField = firstErrorField || 'condoDocument';
            }

            // Validacao: CEP
            if (!formData.condoCep || formData.condoCep.replace(/\D/g, '').length !== 8) {
                showFieldError('condoCep');
                hasError = true;
                firstErrorField = firstErrorField || 'condoCep';
            }

            // Validacao: Rua
            if (!formData.condoStreet) {
                showFieldError('condoStreet');
                hasError = true;
                firstErrorField = firstErrorField || 'condoStreet';
            }

            // Validacao: Numero
            if (!formData.condoNumber) {
                showFieldError('condoNumber');
                hasError = true;
                firstErrorField = firstErrorField || 'condoNumber';
            }

            // Validacao: Bairro
            if (!formData.condoNeighborhood) {
                showFieldError('condoNeighborhood');
                hasError = true;
                firstErrorField = firstErrorField || 'condoNeighborhood';
            }

            // Validacao: Cidade
            if (!formData.condoCity) {
                showFieldError('condoCity');
                hasError = true;
                firstErrorField = firstErrorField || 'condoCity';
            }

            // Validacao: Estado
            if (!formData.condoState) {
                showFieldError('condoState');
                hasError = true;
                firstErrorField = firstErrorField || 'condoState';
            }

            // Validacao: Nome Completo (com sobrenome)
            if (!formData.adminName || !validateFullName(formData.adminName)) {
                showFieldError('adminName');
                hasError = true;
                firstErrorField = firstErrorField || 'adminName';
            }

            // Validacao: E-mail
            if (!formData.adminEmail || !validateEmail(formData.adminEmail)) {
                showFieldError('adminEmail');
                hasError = true;
                firstErrorField = firstErrorField || 'adminEmail';
            }

            // Validacao: Senha
            if (!formData.adminPassword || formData.adminPassword.length < 6) {
                showFieldError('adminPassword');
                hasError = true;
                firstErrorField = firstErrorField || 'adminPassword';
            }

            // Validacao: Confirmacao de Senha
            if (formData.adminPassword !== formData.adminPasswordConfirm) {
                showFieldError('adminPasswordConfirm');
                hasError = true;
                firstErrorField = firstErrorField || 'adminPasswordConfirm';
            }

            // Validacao: Aceite dos Termos
            if (!formData.acceptTerms) {
                showFieldError('acceptTerms');
                hasError = true;
                firstErrorField = firstErrorField || 'acceptTerms';
            }

            // Se houver erro, foca no primeiro campo com erro
            if (hasError) {
                if (firstErrorField) {
                    const el = document.getElementById(firstErrorField);
                    if (el) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        el.focus();
                    }
                }
                return;
            }

            // Inicia loading
            setLoading(true);

            try {
                // Simula delay de rede
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Executa registro
                const result = await handleRegistration(formData);

                // Mostra modal de sucesso
                showSuccessModal(result.condoId, result.username);

            } catch (error) {
                showError(error.message || 'Erro ao criar conta. Tente novamente.');
            } finally {
                setLoading(false);
            }
        });

        // Limpa erros ao digitar
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('input', function() {
                hideFieldError(this.id);
            });
        });

        // ================================================================
        // FUNCOES DO MODAL DE SUCESSO
        // ================================================================

        // Variaveis para armazenar dados do registro
        let registeredCondoId = null;
        let registeredEmail = null;

        // Mostra o modal de sucesso com os dados
        function showSuccessModal(condoId, email) {
            registeredCondoId = condoId;
            registeredEmail = email;

            // Preenche os dados no modal
            document.getElementById('modalCondoId').textContent = condoId;
            document.getElementById('modalAdminEmail').textContent = email;

            // Esconde o formulario e mostra o modal
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('successModal').classList.remove('hidden');

            // Scroll para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });

            console.log('[REGISTRO] Modal de sucesso exibido:', { condoId, email });
        }

        // Copia texto para clipboard
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                // Feedback visual temporario
                const btn = event.currentTarget;
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar:', err);
            });
        }

        // Salva dados e redireciona para login
        function goToLoginWithCredentials() {
            if (!registeredCondoId || !registeredEmail) {
                console.error('[REGISTRO] Dados de registro nao encontrados');
                window.location.href = '/';
                return;
            }

            // Salva os dados no localStorage para pre-preenchimento
            const tempLoginInfo = {
                condoId: registeredCondoId,
                username: registeredEmail,
                timestamp: Date.now()
            };

            localStorage.setItem('temp_login_info', JSON.stringify(tempLoginInfo));
            console.log('[REGISTRO] Dados salvos para pre-preenchimento:', tempLoginInfo);

            // Redireciona para a pagina de login
            window.location.href = '/';
        }
    </script>
</body>
</html>
